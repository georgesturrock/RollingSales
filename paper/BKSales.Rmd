---
title: "BKSales"
author: "George Sturrock"
date: "June 10, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


The source data set is Rolling home sales data from Brooklyn, New York.  This data is freely accessible on New York City's .gov website.  The following code cleanses and prepares the data for analysis.

```{r 1, include=FALSE}
#install the gdata and plyr packages and load in to R.
library(plyr)
library(gdata)
```

```{r 3, include=FALSE}
setwd("C:\\Users\\Sturrock\\Documents\\SMU Data Science\\Doing Data Science\\RollingSales\\data")

bk <- read.csv("rollingsales_brooklyn.csv",skip=4,header=TRUE)


## clean/format the data with regular expressions
## More on these later. For now, know that the
## pattern "[^[:digit:]]" refers to members of the variable name that
## start with digits. We use the gsub command to replace them with a blank space.
# We create a new variable that is a "clean' version of sale.price.
# And sale.price.n is numeric, not a factor.
bk$SALE.PRICE.N <- as.numeric(gsub("[^[:digit:]]","", bk$SALE.PRICE))
count(is.na(bk$SALE.PRICE.N))

names(bk) <- tolower(names(bk)) # make all variable names lower case

## TODO: Get rid of leading digits bk$gross.square.feet as above bk$SALE.PRICE
bk$gross.sqft <- as.numeric(gsub("[^[:digit:]]","", bk$gross.square.feet))


# TODO: Get rid of leading digits of bk$land.sqft as above bk$SALE.PRICE
bk$land.sqft <- as.numeric(gsub("[^[:digit:]]","", bk$land.square.feet))
#bk$land.sqft <- as.numeric(bk$land.square.feet)
  
bk$year.built <- as.numeric(as.character(bk$year.built))

## keep only the actual sales
bk.sale <- bk[bk$sale.price.n!=0,]
plot(bk.sale$gross.sqft,bk.sale$sale.price.n)
plot(log10(bk.sale$gross.sqft),log10(bk.sale$sale.price.n))

## for now, let's look at 1-, 2-, and 3-family homes
bk.homes <- bk.sale[which(grepl("FAMILY",bk.sale$building.class.category)),]
dim(bk.homes)

```


The following plot normalizes and illustrates the relationship between Gross Square Feet and Sales Price. The plot appears to show a positive correlation between Gross Square Feet and Sales price.  As gross square footage increases, the sales price increases as well.  However, there are several data point where the sales price is near or equal to zero.  This muttles the picture and makes it hard to visually determine if a relationship between these two variables exists.

```{r bk.homes1}
# TODO: complete plot() with log10 of bk.homes$gross.sqft,bk.homes$sale.price.n
#   as above "bk.sale"
plot(log10(bk.homes$gross.sqft), log10(bk.homes$sale.price.n))

```



```{r 2, include=FALSE}

## remove outliers that seem like they weren't actual sales
bk.homes$outliers <- (log10(bk.homes$sale.price.n) <=5) + 0

# TODO: find out homes that meets bk.homes$outliers==0
bk.homes <- bk.homes[which(bk.homes$outliers==0),]
```


The following plot is similar to the prior plot.  However, outliers with sales prices less that $5 have been removed in an attempt to provide a more accurate picture of the relationship between Gross Square Feet and Sales Price.  The plot with outliers removed clearly shows a positive relationship between gross square feet and sales price.  A linear regression line has been added to the plot to verify this conclusion. 

```{r bk.homes2}
reg1 <- lm(log10(bk.homes$sale.price.n) ~ log10(bk.homes$gross.sqft))
plot(log10(bk.homes$gross.sqft),log10(bk.homes$sale.price.n))
abline(reg1)
```


